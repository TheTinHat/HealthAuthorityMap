<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
     <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
 integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
 crossorigin=""></script>
 <script src="https://unpkg.com/geobuf@3.0.2/dist/geobuf.js" crossorigin=""></script>
 <script src="https://unpkg.com/pbf@3.0.5/dist/pbf.js" crossorigin=""></script>
</head>
<body>

    <div id="mapid" style="height:100%; width: 100%;"></div>

    <script>

        var mymap = L.map('mapid');
        var geojsonMarkerOptions = {
          radius: 5,
          fillColor: "#800080",
          color: "#000",
          weight: 1,
          opacity: 1,
          fillOpacity: 0.6
        };

        var CartoDB_Positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
	        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	        subdomains: 'abcd',
	        maxZoom: 19
        }).addTo(mymap);
    
        function getColor(d) {
            return d == "Fraser" ? '#fbb4ae' :
                d == "Vancouver Coastal"  ? '#b3cde3' :
                d == "Northern"  ? '#ccebc5' :
                d == "Interior"  ? '#decbe4' :
                d = "Vancouver Island"   ? '#fed9a6' :
                            '#000';
        }
            
        function style(feature) {
            return {
                fillColor: getColor(feature.properties.HA_Name),
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.6
            };
            
        }

        fetch('https://wtfsahealthauthority.xyz/lha_small.pbf')
            .then(response => response.arrayBuffer())
            .then(data => geojson = geobuf.decode(new Pbf(new Uint8Array(data))))
            .then(addToMap => map = L.geoJson(geojson, {style: style}).addTo(mymap))
            .then(fitMap => mymap.fitBounds(map.getBounds()));

        /* THIS CODE WOULD ALSO WORK
        var get_data = async () => {
            var response = await fetch('https://wtfsahealthauthority.xyz/lha_small.pbf');
            var data = await response.arrayBuffer();
            var geojson = geobuf.decode(new Pbf(new Uint8Array(data)));
            map = L.geoJson(geojson, {style: style}).addTo(mymap);
            mymap.fitBounds(map.getBounds());
        }
        get_data();
        */

      </script>

</body>


</html>